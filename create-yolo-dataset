{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/samu2505/create-yolo-dataset?scriptVersionId=174861644\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"7604aa52","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","papermill":{"duration":0.004794,"end_time":"2024-04-30T09:18:24.753231","exception":false,"start_time":"2024-04-30T09:18:24.748437","status":"completed"},"tags":[]},"source":["# Create yolo dataset\n","\n","## Part 1: Based on xml annotations"]},{"cell_type":"code","execution_count":1,"id":"81ff608f","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:24.764668Z","iopub.status.busy":"2024-04-30T09:18:24.764156Z","iopub.status.idle":"2024-04-30T09:18:28.31067Z","shell.execute_reply":"2024-04-30T09:18:28.309519Z"},"papermill":{"duration":3.555778,"end_time":"2024-04-30T09:18:28.313583","exception":false,"start_time":"2024-04-30T09:18:24.757805","status":"completed"},"tags":[]},"outputs":[],"source":["import os, gc, sys, yaml, shutil\n","from pathlib import Path\n","from tqdm.auto import tqdm\n","\n","import math\n","import random\n","import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","\n","from sklearn import model_selection\n","\n","import PIL\n","import cv2\n","\n","import xml\n","import xml.etree.ElementTree as ET\n","from xml.dom import minidom\n","\n","random.seed(42)"]},{"cell_type":"code","execution_count":2,"id":"6b5203ab","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.325479Z","iopub.status.busy":"2024-04-30T09:18:28.324653Z","iopub.status.idle":"2024-04-30T09:18:28.341017Z","shell.execute_reply":"2024-04-30T09:18:28.33953Z"},"papermill":{"duration":0.026458,"end_time":"2024-04-30T09:18:28.344473","exception":false,"start_time":"2024-04-30T09:18:28.318015","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["['annotations', 'images']"]},"execution_count":2,"metadata":{},"output_type":"execute_result"}],"source":["DATA_PATH = Path(\"/kaggle/input/road-sign-detection\")\n","os.listdir(DATA_PATH)"]},{"cell_type":"code","execution_count":3,"id":"3fc19304","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.356836Z","iopub.status.busy":"2024-04-30T09:18:28.356118Z","iopub.status.idle":"2024-04-30T09:18:28.360719Z","shell.execute_reply":"2024-04-30T09:18:28.359955Z"},"papermill":{"duration":0.013249,"end_time":"2024-04-30T09:18:28.363101","exception":false,"start_time":"2024-04-30T09:18:28.349852","status":"completed"},"tags":[]},"outputs":[],"source":["# !cat /kaggle/input/road-sign-detection/annotations/road4.xml"]},{"cell_type":"code","execution_count":4,"id":"f8d439e9","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.374966Z","iopub.status.busy":"2024-04-30T09:18:28.374194Z","iopub.status.idle":"2024-04-30T09:18:28.385388Z","shell.execute_reply":"2024-04-30T09:18:28.38431Z"},"papermill":{"duration":0.01975,"end_time":"2024-04-30T09:18:28.388033","exception":false,"start_time":"2024-04-30T09:18:28.368283","status":"completed"},"tags":[]},"outputs":[],"source":["# function to get the data from XML annotation\n","def extract_info_from_xml(xml_file):\n","    root = ET.parse(xml_file).getroot()\n","    \n","    # initialize the info dict\n","    info_dict = {}\n","    info_dict['bboxes'] = []\n","    \n","    # parse the xml tree\n","    for elem in root:\n","        # get file name\n","        if elem.tag == \"filename\":\n","            info_dict['filename'] = elem.text\n","        \n","        # get the image size\n","        elif elem.tag == \"size\":\n","            image_size = []\n","            for subelem in elem:\n","                image_size.append(int(subelem.text))\n","                \n","            info_dict['image_size'] = tuple(image_size)\n","            \n","        # get details of the bounding box\n","        elif elem.tag == \"object\":\n","            bbox = {}\n","            for subelem in elem:\n","                if subelem.tag == \"name\":\n","                    bbox[\"class\"] = subelem.text\n","                elif subelem.tag == \"bndbox\":\n","                    for subsubelem in subelem:\n","                        bbox[subsubelem.tag] = int(subsubelem.text)\n","            info_dict['bboxes'].append(bbox)\n","            \n","    return info_dict"]},{"cell_type":"code","execution_count":5,"id":"5cfeed87","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.399506Z","iopub.status.busy":"2024-04-30T09:18:28.398622Z","iopub.status.idle":"2024-04-30T09:18:28.416697Z","shell.execute_reply":"2024-04-30T09:18:28.415678Z"},"papermill":{"duration":0.026743,"end_time":"2024-04-30T09:18:28.419219","exception":false,"start_time":"2024-04-30T09:18:28.392476","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["{'bboxes': [{'class': 'trafficlight',\n","   'xmin': 98,\n","   'ymin': 62,\n","   'xmax': 208,\n","   'ymax': 232}],\n"," 'filename': 'road0.png',\n"," 'image_size': (267, 400, 3)}"]},"execution_count":5,"metadata":{},"output_type":"execute_result"}],"source":["ANNOTATION_DIR = Path(\"/kaggle/input/road-sign-detection/annotations\")\n","info_dict = extract_info_from_xml(ANNOTATION_DIR/\"road0.xml\")\n","info_dict"]},{"cell_type":"code","execution_count":6,"id":"d47bf9ba","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.433411Z","iopub.status.busy":"2024-04-30T09:18:28.432566Z","iopub.status.idle":"2024-04-30T09:18:28.437958Z","shell.execute_reply":"2024-04-30T09:18:28.437129Z"},"papermill":{"duration":0.015203,"end_time":"2024-04-30T09:18:28.440634","exception":false,"start_time":"2024-04-30T09:18:28.425431","status":"completed"},"tags":[]},"outputs":[],"source":["# convert the information contain in info_dict to Yolo format\n","# dictionary that maps class names to IDs\n","class_name_to_id_mapping = {\n","    \"trafficlight\": 0,\n","    \"stop\": 1,\n","    \"speedlimit\": 2,\n","    \"crosswalk\": 3\n","}"]},{"cell_type":"code","execution_count":7,"id":"7787bddb","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.452497Z","iopub.status.busy":"2024-04-30T09:18:28.451689Z","iopub.status.idle":"2024-04-30T09:18:28.459263Z","shell.execute_reply":"2024-04-30T09:18:28.458174Z"},"papermill":{"duration":0.016316,"end_time":"2024-04-30T09:18:28.461612","exception":false,"start_time":"2024-04-30T09:18:28.445296","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["0"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["for box in info_dict['bboxes']:\n","    id_ = class_name_to_id_mapping[box['class']]\n","id_"]},{"cell_type":"code","execution_count":8,"id":"b547d897","metadata":{"execution":{"iopub.execute_input":"2024-04-30T09:18:28.475434Z","iopub.status.busy":"2024-04-30T09:18:28.474646Z","iopub.status.idle":"2024-04-30T09:18:28.986466Z","shell.execute_reply":"2024-04-30T09:18:28.984275Z"},"papermill":{"duration":0.522446,"end_time":"2024-04-30T09:18:28.990555","exception":false,"start_time":"2024-04-30T09:18:28.468109","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["(877, 877)"]},"execution_count":8,"metadata":{},"output_type":"execute_result"}],"source":["len(os.listdir(\"/kaggle/input/road-sign-detection/annotations\")), len(os.listdir(\"/kaggle/input/road-sign-detection/images\"))"]},{"cell_type":"code","execution_count":null,"id":"62e9c038","metadata":{"papermill":{"duration":0.005666,"end_time":"2024-04-30T09:18:29.001679","exception":false,"start_time":"2024-04-30T09:18:28.996013","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":671172,"sourceId":1181356,"sourceType":"datasetVersion"}],"dockerImageVersionId":30698,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.13"},"papermill":{"default_parameters":{},"duration":8.537398,"end_time":"2024-04-30T09:18:29.731896","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-04-30T09:18:21.194498","version":"2.5.0"}},"nbformat":4,"nbformat_minor":5}